

find_package(MKL REQUIRED)


set(TARGET_PRICER_SOURCES
        math/pricers/mkl_pricer.c
        math/pricers/sleef_pricer.c)

set(TARGET_PRICER_HEADERS
        math/pricers/pricer-base.h
        math/pricers/mkl_pricer.h
        math/pricers/sleef_pricer.h)

file(WRITE ${CMAKE_BINARY_DIR}/dispatcher.c "// Automatically generated by src/CMakelists.txt. \n//\n// DO NOT CHANGE\n//\n\n")
file(APPEND ${CMAKE_BINARY_DIR}/dispatcher.c "#include <math/pricers/pricer-base.h>\n\n")


foreach(SIMD ${PRICER_SUPPORTED_EXTENSIONS})
    if(COMPILER_SUPPORTS_${SIMD})
        add_library(${TARGET_LIBPRICER}_${SIMD} ${TARGET_PRICER_SOURCES} ${TARGET_PRICER_HEADERS})
        target_compile_definitions( ${TARGET_LIBPRICER}_${SIMD} PRIVATE ENABLE_${SIMD}=1 DORENAME=1)
        target_compile_options(${TARGET_LIBPRICER}_${SIMD} PRIVATE ${FLAGS_ENABLE_${SIMD}} ${OpenMP_C_FLAGS} -Wno-unused-function -Wno-attributes)
        target_include_directories(${TARGET_LIBPRICER}_${SIMD} PRIVATE
                ./
                $ENV{SPACK_TRANSITIVE_INCLUDE_PATH}
                ${MKL_INCLUDE_DIRS}
                ${CMAKE_SOURCE_DIR}/3rdParty/sleef/src/arch
                ${CMAKE_SOURCE_DIR}/3rdParty/sleef/src/common
                ${CMAKE_SOURCE_DIR}/3rdParty/sleef/src/libm
                ${CMAKE_BINARY_DIR}/3rdParty/sleef/src/libm/include )
        set_target_properties(${TARGET_LIBPRICER}_${SIMD} PROPERTIES
                VERSION ${PRICER_VERSION}
                SOVERSION ${PRICER_SOVERSION}
                ${COMMON_TARGET_PROPERTIES}
                )
        target_link_libraries(${TARGET_LIBPRICER}_${SIMD} sleef)

    endif()
endforeach()

#add_compile_definitions(ENABLE_AVX=1)
#add_compile_definitions(DORENAME =1)
#include_directories(
#        ./
#        $ENV{SPACK_TRANSITIVE_INCLUDE_PATH}
#        ${MKL_INCLUDE_DIRS}
#        ${CMAKE_SOURCE_DIR}/3rdParty/sleef/src/arch
#        ${CMAKE_SOURCE_DIR}/3rdParty/sleef/src/common
#        ${CMAKE_SOURCE_DIR}/3rdParty/sleef/src/libm
#        ${CMAKE_BINARY_DIR}/3rdParty/sleef/src/libm/include)

#add_library(${TARGET_LIBPRICER} ${TARGET_PRICER_SOURCES} ${TARGET_PRICER_HEADERS})

